<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÎÑ∑ÌèºÏïåÏï§Îîî KPI ÎåÄÏãúÎ≥¥Îìú</title>
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            /* ÎùºÏù¥Ìä∏ Î™®Îìú - ÌÜ†Ïä§ Ïª¨Îü¨ ÏãúÏä§ÌÖú */
            --bg: #f7f8fa;
            --bg-elevated: #ffffff;
            --blue: #3182f6;
            --blue-light: #e8f3ff;
            --blue-dark: #1b64da;
            --green: #00c471;
            --green-light: #e5f9ed;
            --red: #f04452;
            --red-light: #ffebee;
            --orange: #ff8a00;
            --orange-light: #fff3e0;
            --text-primary: #191f28;
            --text-secondary: #4e5968;
            --text-tertiary: #8b95a1;
            --text-disabled: #b0b8c1;
            --border: #e5e8eb;
            --border-light: #f2f4f6;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.04);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.06);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.08);
            --radius-sm: 12px;
            --radius-md: 16px;
            --radius-lg: 24px;
        }

        /* Îã§ÌÅ¨ Î™®Îìú */
        [data-theme="dark"] {
            --bg: #0a0a0a;
            --bg-elevated: #1a1a1a;
            --blue: #3182f6;
            --blue-light: rgba(49, 130, 246, 0.15);
            --blue-dark: #4593fc;
            --green: #00c471;
            --green-light: rgba(0, 196, 113, 0.15);
            --red: #f04452;
            --red-light: rgba(240, 68, 82, 0.15);
            --orange: #ff8a00;
            --orange-light: rgba(255, 138, 0, 0.15);
            --text-primary: #ffffff;
            --text-secondary: #b0b8c1;
            --text-tertiary: #6b7684;
            --text-disabled: #4e5968;
            --border: #2a2a2a;
            --border-light: #1f1f1f;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.2);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.3);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.4);
        }

        body {
            font-family: 'Pretendard', -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text-primary);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        /* ========== Î†àÏù¥ÏïÑÏõÉ ========== */
        .app {
            display: flex;
            min-height: 100vh;
        }

        /* ========== ÏÇ¨Ïù¥ÎìúÎ∞î ========== */
        .sidebar {
            width: 240px;
            min-width: 240px;
            background: var(--bg-elevated);
            padding: 24px 16px;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border);
            position: sticky;
            top: 0;
            height: 100vh;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 0 12px 24px;
            border-bottom: 1px solid var(--border-light);
            margin-bottom: 24px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--blue);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 800;
            font-size: 10px;
        }

        .logo-text {
            font-size: 15px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .logo-text span {
            display: block;
            font-size: 11px;
            font-weight: 500;
            color: var(--text-tertiary);
            margin-top: 2px;
        }

        .nav-section { margin-bottom: 20px; }

        .nav-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-tertiary);
            padding: 0 12px;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.15s ease;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 2px;
        }

        .nav-item:hover {
            background: var(--bg);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: var(--blue-light);
            color: var(--blue);
            font-weight: 600;
        }

        .sidebar-footer {
            margin-top: auto;
            padding-top: 16px;
            border-top: 1px solid var(--border-light);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            background: var(--blue);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 12px;
        }

        .user-name { font-size: 14px; font-weight: 600; color: var(--text-primary); }
        .user-role { font-size: 12px; color: var(--text-tertiary); }

        /* ========== Î©îÏù∏ ========== */
        .main {
            flex: 1;
            overflow-y: auto;
        }

        /* ========== ÌûàÏñ¥Î°ú ========== */
        .hero {
            background: var(--bg-elevated);
            padding: 40px 48px;
            border-bottom: 1px solid var(--border);
        }

        .hero-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 32px;
        }

        .hero-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -0.5px;
        }

        .hero-subtitle {
            font-size: 15px;
            color: var(--text-tertiary);
            margin-top: 6px;
        }

        .hero-actions {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 12px 20px;
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.15s ease;
        }

        .btn-secondary {
            background: var(--bg);
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--border-light);
        }

        .btn-primary {
            background: var(--blue);
            color: white;
        }

        .btn-primary:hover {
            background: var(--blue-dark);
        }

        /* Ïä§ÌÉØ Í∑∏Î¶¨Îìú */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
        }

        .stat-card {
            background: var(--bg);
            border-radius: var(--radius-md);
            padding: 24px;
            transition: all 0.2s ease;
        }

        .stat-card:hover {
            background: var(--border-light);
        }

        .stat-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-tertiary);
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 800;
            color: var(--text-primary);
            letter-spacing: -1px;
            line-height: 1;
        }

        .stat-change {
            display: inline-flex;
            align-items: center;
            margin-top: 10px;
            font-size: 13px;
            font-weight: 600;
            color: var(--green);
        }

        .stat-change.down { color: var(--red); }

        /* ========== ÏΩòÌÖêÏ∏† ========== */
        .content {
            padding: 32px 48px;
        }

        .section {
            margin-bottom: 40px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .section-subtitle {
            font-size: 13px;
            color: var(--text-tertiary);
        }

        /* Ïπ¥Îìú */
        .card {
            background: var(--bg-elevated);
            border-radius: var(--radius-lg);
            padding: 28px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
        }

        .card-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        /* Ï∞®Ìä∏ Í∑∏Î¶¨Îìú */
        .chart-grid {
            display: grid;
            grid-template-columns: 1.3fr 1fr;
            gap: 20px;
            margin-bottom: 40px;
        }

        .chart-area {
            height: 280px;
        }

        /* ÎèÑÎÑõ */
        .donut-layout {
            display: flex;
            align-items: center;
            gap: 32px;
        }

        .donut-wrap {
            position: relative;
            width: 160px;
            height: 160px;
            flex-shrink: 0;
        }

        .donut-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .donut-value {
            font-size: 40px;
            font-weight: 800;
            color: var(--blue);
            letter-spacing: -2px;
            line-height: 1;
        }

        .donut-label {
            font-size: 13px;
            color: var(--text-tertiary);
            margin-top: 4px;
        }

        .donut-stats {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .donut-stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            background: var(--bg);
            border-radius: var(--radius-sm);
        }

        .donut-stat-label {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .donut-stat-value {
            font-size: 20px;
            font-weight: 700;
        }

        .donut-stat-value.green { color: var(--green); }
        .donut-stat-value.orange { color: var(--orange); }

        /* ========== Î∂ÄÏÑú Í∑∏Î¶¨Îìú ========== */
        .dept-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: 16px;
        }

        .dept-card {
            background: var(--bg-elevated);
            border-radius: var(--radius-md);
            padding: 24px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .dept-card:hover {
            box-shadow: var(--shadow-md);
            border-color: var(--blue);
        }

        .dept-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .dept-name {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .dept-leader {
            font-size: 13px;
            color: var(--text-tertiary);
            margin-top: 4px;
        }

        .dept-pct {
            font-size: 28px;
            font-weight: 800;
            color: var(--blue);
        }

        .dept-pct.low { color: var(--orange); }
        .dept-pct.critical { color: var(--red); }

        .dept-bar {
            height: 6px;
            background: var(--bg);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .dept-bar-fill {
            height: 100%;
            background: var(--blue);
            border-radius: 3px;
            transition: width 0.6s ease;
        }

        .dept-bar-fill.low { background: var(--orange); }
        .dept-bar-fill.critical { background: var(--red); }

        .dept-meta {
            font-size: 13px;
            color: var(--text-tertiary);
        }

        /* ========== ÏÑ±Í≥ºÏûê ========== */
        .winners-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .winner-card {
            background: var(--bg-elevated);
            border-radius: var(--radius-lg);
            padding: 32px 24px;
            text-align: center;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            transition: all 0.2s ease;
        }

        .winner-card:hover {
            box-shadow: var(--shadow-md);
        }

        .winner-card.gold { border-top: 3px solid #FFB800; }
        .winner-card.silver { border-top: 3px solid #8B95A1; }
        .winner-card.bronze { border-top: 3px solid #CD7F32; }

        .winner-rank {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 800;
            color: white;
            margin: 0 auto 20px;
        }

        .winner-card.gold .winner-rank { background: linear-gradient(135deg, #FFB800, #FFD54F); }
        .winner-card.silver .winner-rank { background: linear-gradient(135deg, #8B95A1, #B0B8C1); }
        .winner-card.bronze .winner-rank { background: linear-gradient(135deg, #CD7F32, #DDA15E); }

        .winner-avatar {
            width: 72px;
            height: 72px;
            border-radius: 20px;
            background: var(--blue);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            font-weight: 800;
            color: white;
            margin: 0 auto 16px;
        }

        .winner-name {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .winner-dept {
            font-size: 13px;
            color: var(--text-tertiary);
            margin-bottom: 16px;
        }

        .winner-score {
            font-size: 32px;
            font-weight: 800;
            color: var(--blue);
        }

        .winner-score-label {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-top: 4px;
        }

        /* ========== ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄ ========== */
        .page { display: none; }
        .page.active { display: block; }

        .detail-hero {
            background: var(--bg-elevated);
            padding: 32px 48px;
            border-bottom: 1px solid var(--border);
        }

        .detail-header {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .back-btn {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-sm);
            background: var(--bg);
            border: 1px solid var(--border);
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            transition: all 0.15s ease;
        }

        .back-btn:hover {
            background: var(--border-light);
        }

        .detail-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .detail-subtitle {
            font-size: 14px;
            color: var(--text-tertiary);
            margin-top: 4px;
        }

        .detail-stats {
            margin-left: auto;
            display: flex;
            gap: 40px;
        }

        .detail-stat { text-align: center; }

        .detail-stat-value {
            font-size: 28px;
            font-weight: 800;
            color: var(--blue);
        }

        .detail-stat-label {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-top: 2px;
        }

        .detail-content {
            padding: 32px 48px;
        }

        /* ÌÉ≠ */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 20px;
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            background: var(--bg);
            color: var(--text-secondary);
            transition: all 0.15s ease;
        }

        .tab:hover {
            background: var(--border-light);
        }

        .tab.active {
            background: var(--blue);
            color: white;
        }

        /* Î©§Î≤Ñ Í∑∏Î¶¨Îìú */
        .member-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 12px;
            margin-bottom: 28px;
        }

        .member-card {
            background: var(--bg);
            border-radius: var(--radius-sm);
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 14px;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .member-card:hover {
            background: var(--blue-light);
        }

        .member-avatar {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: var(--blue);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 15px;
            font-weight: 700;
            color: white;
        }

        .member-info { flex: 1; }
        .member-name { font-size: 15px; font-weight: 600; color: var(--text-primary); }
        .member-role { font-size: 13px; color: var(--text-tertiary); }
        .member-right { text-align: right; }
        .member-pct { font-size: 20px; font-weight: 800; color: var(--blue); }
        .member-cnt { font-size: 12px; color: var(--text-tertiary); }

        /* ÏóÖÎ¨¥ */
        .task-section { margin-top: 24px; }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .task-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .btn-add {
            padding: 12px 20px;
            border-radius: var(--radius-sm);
            background: var(--blue);
            color: white;
            font-size: 14px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .btn-add:hover {
            background: var(--blue-dark);
        }

        .task-form {
            background: var(--bg);
            border-radius: var(--radius-md);
            padding: 20px;
            margin-bottom: 16px;
            display: none;
        }

        .task-form.show { display: block; }

        .task-form-row {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        .input {
            flex: 2;
            min-width: 180px;
            padding: 14px 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-family: inherit;
            background: var(--bg-elevated);
            transition: border-color 0.15s ease;
        }

        .input:focus {
            outline: none;
            border-color: var(--blue);
        }

        .select {
            padding: 14px 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-family: inherit;
            background: var(--bg-elevated);
            cursor: pointer;
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .task-item {
            background: var(--bg);
            border-radius: var(--radius-sm);
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .task-name {
            flex: 2;
            min-width: 140px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .task-name input {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid var(--blue);
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            display: none;
        }

        .task-name input.show { display: block; }
        .task-name span.hide { display: none; }

        .task-select {
            padding: 10px 14px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 13px;
            font-family: inherit;
            background: var(--bg-elevated);
            cursor: pointer;
        }

        .task-actions {
            display: flex;
            gap: 6px;
        }

        .btn-xs {
            padding: 8px 14px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .btn-edit { background: var(--blue-light); color: var(--blue); }
        .btn-del { background: var(--red-light); color: var(--red); }
        .btn-edit:hover { background: #d0e4ff; }
        .btn-del:hover { background: #ffd6d9; }

        .empty-state {
            text-align: center;
            padding: 48px 20px;
            color: var(--text-tertiary);
        }

        .empty-text {
            font-size: 14px;
            font-weight: 500;
        }

        /* Î™®Îã¨ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
        }

        .modal.show { opacity: 1; pointer-events: auto; }

        .modal-box {
            background: var(--bg-elevated);
            border-radius: var(--radius-lg);
            width: 90%;
            max-width: 440px;
            overflow: hidden;
            transform: scale(0.95);
            transition: transform 0.2s ease;
        }

        .modal.show .modal-box { transform: scale(1); }

        .modal-header {
            padding: 28px;
            display: flex;
            align-items: center;
            gap: 16px;
            border-bottom: 1px solid var(--border-light);
        }

        .modal-avatar {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            background: var(--blue);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 800;
            color: white;
        }

        .modal-name { font-size: 20px; font-weight: 700; color: var(--text-primary); }
        .modal-dept { font-size: 14px; color: var(--text-tertiary); }

        .modal-close {
            margin-left: auto;
            width: 40px;
            height: 40px;
            border-radius: var(--radius-sm);
            border: none;
            background: var(--bg);
            cursor: pointer;
            font-size: 18px;
            color: var(--text-secondary);
            transition: background 0.15s ease;
        }

        .modal-close:hover { background: var(--border-light); }

        .modal-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            background: var(--bg);
            padding: 24px;
        }

        .modal-stat { text-align: center; }
        .modal-stat-value { font-size: 24px; font-weight: 800; color: var(--blue); }
        .modal-stat-label { font-size: 12px; color: var(--text-tertiary); margin-top: 4px; }

        .modal-body {
            padding: 20px 24px 28px;
            max-height: 280px;
            overflow-y: auto;
        }

        .modal-task {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            background: var(--bg);
            border-radius: var(--radius-sm);
            margin-bottom: 8px;
        }

        .modal-task-name { font-size: 14px; font-weight: 600; color: var(--text-primary); }
        .modal-task-sub { font-size: 12px; color: var(--text-tertiary); }
        .modal-task-pct { font-size: 18px; font-weight: 800; color: var(--blue); }

        /* ÌÜ†Ïä§Ìä∏ */
        .toast {
            position: fixed;
            bottom: 32px;
            left: 50%;
            transform: translateX(-50%) translateY(80px);
            background: var(--text-primary);
            color: white;
            padding: 16px 28px;
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-weight: 600;
            z-index: 2000;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 1200px) {
            .chart-grid { grid-template-columns: 1fr; }
            .winners-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 900px) {
            .sidebar { display: none; }
            .hero { padding: 24px; }
            .content { padding: 24px; }
            .detail-hero { padding: 24px; }
            .detail-content { padding: 24px; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 600px) {
            .stats-grid { grid-template-columns: 1fr; }
            .donut-layout { flex-direction: column; }
        }

        /* Ïï†ÎãàÎ©îÏù¥ÏÖò */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate { animation: fadeIn 0.4s ease forwards; }

        /* Îã§ÌÅ¨Î™®Îìú ÌÜ†Í∏Ä */
        .theme-toggle {
            width: 44px;
            height: 44px;
            border-radius: var(--radius-sm);
            background: var(--bg);
            border: 1px solid var(--border);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.2s ease;
        }

        .theme-toggle:hover {
            background: var(--border-light);
        }

        [data-theme="dark"] .theme-toggle {
            background: var(--bg-elevated);
        }

        .theme-icon-light,
        .theme-icon-dark {
            display: none;
        }

        :root .theme-icon-light { display: block; }
        :root .theme-icon-dark { display: none; }
        [data-theme="dark"] .theme-icon-light { display: none; }
        [data-theme="dark"] .theme-icon-dark { display: block; }
    </style>
</head>
<body>
    <div class="app">
        <!-- ÏÇ¨Ïù¥ÎìúÎ∞î -->
        <aside class="sidebar">
            <div class="logo">
                <div class="logo-icon">POUR</div>
                <div class="logo-text">
                    ÎÑ∑ÌèºÏïåÏï§Îîî
                    <span>KPI Dashboard</span>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-label">Î©îÏù∏</div>
                <div class="nav-item active" onclick="goMain()">ÎåÄÏãúÎ≥¥Îìú</div>
            </div>

            <div class="nav-section">
                <div class="nav-label">Î∂ÄÏÑú</div>
                <div id="navDepts"></div>
            </div>

            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar">Î≤îÏÑù</div>
                    <div>
                        <div class="user-name">ÍπÄÎ≤îÏÑù</div>
                        <div class="user-role">Í∑∏Î°úÏä§ÌåÄ Îß§ÎãàÏ†Ä</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Î©îÏù∏ -->
        <main class="main">
            <!-- Î©îÏù∏ ÌéòÏù¥ÏßÄ -->
            <div class="page active" id="mainPage">
                <div class="hero">
                    <div class="hero-top">
                        <div>
                            <h1 class="hero-title">Ï†ÑÏÇ¨ KPI ÎåÄÏãúÎ≥¥Îìú</h1>
                            <p class="hero-subtitle">2026ÎÖÑ 1Ïõî Í∏∞Ï§Ä ¬∑ Ïã§ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏</p>
                        </div>
                        <div class="hero-actions">
                            <button class="theme-toggle" onclick="toggleTheme()" title="ÌÖåÎßà Î≥ÄÍ≤Ω">
                                <span class="theme-icon-light">üåô</span>
                                <span class="theme-icon-dark">‚òÄÔ∏è</span>
                            </button>
                            <button class="btn btn-secondary" onclick="exportData()">ÎÇ¥Î≥¥ÎÇ¥Í∏∞</button>
                            <button class="btn btn-primary" onclick="saveAll()">Ï†ÄÏû•</button>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Ï†ÑÏ≤¥ ÏßÑÏ≤ôÎ•†</div>
                            <div class="stat-value" id="statProgress">0%</div>
                            <div class="stat-change">‚Üë Ï†ÑÏõî ÎåÄÎπÑ +5%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ÏôÑÎ£å ÏóÖÎ¨¥</div>
                            <div class="stat-value" id="statDone">0</div>
                            <div class="stat-change">‚Üë Ïù¥Î≤à Ï£º +3Í±¥</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Îì±Î°ù ÏóÖÎ¨¥</div>
                            <div class="stat-value" id="statTotal">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Ï∞∏Ïó¨ Ïù∏Ïõê</div>
                            <div class="stat-value" id="statMembers">0</div>
                        </div>
                    </div>
                </div>

                <div class="content">
                    <!-- Ï∞®Ìä∏ -->
                    <div class="chart-grid">
                        <div class="card">
                            <div class="card-title">Î∂ÄÏÑúÎ≥Ñ ÏßÑÏ≤ôÎ•†</div>
                            <div class="chart-area">
                                <canvas id="barChart"></canvas>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-title">Ï†ÑÏ≤¥ Îã¨ÏÑ± ÌòÑÌô©</div>
                            <div class="donut-layout">
                                <div class="donut-wrap">
                                    <canvas id="donutChart"></canvas>
                                    <div class="donut-center">
                                        <div class="donut-value" id="donutPct">0%</div>
                                        <div class="donut-label">Îã¨ÏÑ±Î•†</div>
                                    </div>
                                </div>
                                <div class="donut-stats">
                                    <div class="donut-stat-row">
                                        <span class="donut-stat-label">ÏôÑÎ£å</span>
                                        <span class="donut-stat-value green" id="dsDone">0</span>
                                    </div>
                                    <div class="donut-stat-row">
                                        <span class="donut-stat-label">ÏßÑÌñâÏ§ë</span>
                                        <span class="donut-stat-value orange" id="dsPending">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Î∂ÄÏÑúÎ≥Ñ ÌòÑÌô© -->
                    <div class="section">
                        <div class="section-header">
                            <div class="section-title">Î∂ÄÏÑúÎ≥Ñ ÌòÑÌô©</div>
                            <div class="section-subtitle">7Í∞ú Î∂ÄÏÑú</div>
                        </div>
                        <div class="dept-grid" id="deptGrid"></div>
                    </div>

                    <!-- Top ÏÑ±Í≥ºÏûê -->
                    <div class="section">
                        <div class="section-header">
                            <div class="section-title">Ïù¥Î≤à Îã¨ Top ÏÑ±Í≥ºÏûê</div>
                            <div class="section-subtitle">2026ÎÖÑ 1Ïõî Í∏∞Ï§Ä</div>
                        </div>
                        <div class="winners-grid" id="winnersGrid"></div>
                    </div>
                </div>
            </div>

            <!-- ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄ -->
            <div class="page" id="detailPage">
                <div class="detail-hero">
                    <div class="detail-header">
                        <button class="back-btn" onclick="goMain()">‚Üê</button>
                        <div>
                            <h1 class="detail-title" id="detailTitle">Î∂ÄÏÑúÎ™Ö</h1>
                            <p class="detail-subtitle" id="detailSubtitle">Î¶¨Îçî</p>
                        </div>
                        <div class="detail-stats">
                            <div class="detail-stat">
                                <div class="detail-stat-value" id="detailProgress">0%</div>
                                <div class="detail-stat-label">ÏßÑÏ≤ôÎ•†</div>
                            </div>
                            <div class="detail-stat">
                                <div class="detail-stat-value" id="detailTasks">0</div>
                                <div class="detail-stat-label">ÏóÖÎ¨¥</div>
                            </div>
                            <div class="detail-stat">
                                <div class="detail-stat-value" id="detailMembers">0</div>
                                <div class="detail-stat-label">Ïù∏Ïõê</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="detail-content">
                    <div class="tabs" id="tabs"></div>

                    <div class="card">
                        <div class="card-title">ÌåÄÏõêÎ≥Ñ ÌòÑÌô©</div>
                        <div class="member-grid" id="memberGrid"></div>
                    </div>

                    <div class="task-section">
                        <div class="card">
                            <div class="task-header">
                                <div class="task-title">ÏóÖÎ¨¥ Î™©Î°ù</div>
                                <button class="btn-add" onclick="showTaskForm()">+ ÏóÖÎ¨¥ Ï∂îÍ∞Ä</button>
                            </div>
                            <div class="task-form" id="taskForm">
                                <div class="task-form-row">
                                    <input type="text" class="input" id="newName" placeholder="ÏóÖÎ¨¥Î™Ö ÏûÖÎ†•">
                                    <select class="select" id="newAssignee"><option value="">Îã¥ÎãπÏûê</option></select>
                                    <select class="select" id="newProgress">
                                        <option value="0">0%</option>
                                        <option value="10">10%</option>
                                        <option value="20">20%</option>
                                        <option value="30">30%</option>
                                        <option value="40">40%</option>
                                        <option value="50">50%</option>
                                        <option value="60">60%</option>
                                        <option value="70">70%</option>
                                        <option value="80">80%</option>
                                        <option value="90">90%</option>
                                        <option value="100">100%</option>
                                    </select>
                                    <button class="btn-add" onclick="addTask()">Îì±Î°ù</button>
                                    <button class="btn btn-secondary" onclick="hideTaskForm()">Ï∑®ÏÜå</button>
                                </div>
                            </div>
                            <div class="task-list" id="taskList"></div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Î™®Îã¨ -->
    <div class="modal" id="modal">
        <div class="modal-box">
            <div class="modal-header">
                <div class="modal-avatar" id="modalAvatar">Ïù¥Î¶Ñ</div>
                <div>
                    <div class="modal-name" id="modalName">Ïù¥Î¶Ñ</div>
                    <div class="modal-dept" id="modalDept">Î∂ÄÏÑú</div>
                </div>
                <button class="modal-close" onclick="closeModal()">‚úï</button>
            </div>
            <div class="modal-stats">
                <div class="modal-stat">
                    <div class="modal-stat-value" id="modalProgress">0%</div>
                    <div class="modal-stat-label">ÌèâÍ∑† ÏßÑÏ≤ôÎ•†</div>
                </div>
                <div class="modal-stat">
                    <div class="modal-stat-value" id="modalTasks">0</div>
                    <div class="modal-stat-label">Îã¥Îãπ ÏóÖÎ¨¥</div>
                </div>
                <div class="modal-stat">
                    <div class="modal-stat-value" id="modalDone">0</div>
                    <div class="modal-stat-label">ÏôÑÎ£å</div>
                </div>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <div class="toast" id="toast">Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§</div>

    <script>
        const ORG = {
            departments: [
                {
                    id: 'sales', name: 'ÏòÅÏóÖÎ≥∏Î∂Ä', color: 'blue',
                    leader: 'Ìô©Ïú§ÏÑ† ÏÉÅÎ¨¥Ïù¥ÏÇ¨', headcount: 10,
                    subDepts: [
                        { id: 'sales_1', name: 'ÏÑúÎπÑÏä§Ïö¥ÏòÅ 1ÌåÄ', members: ['ÌïúÏ§ÄÏóΩ Î¶¨ÎìúÎß§ÎãàÏ†Ä', 'Ï°∞Ïû¨Ïó∞ Îß§ÎãàÏ†Ä', 'Ïû•Ï†ïÌõà Îß§ÎãàÏ†Ä', 'ÍπÄÏÑ±ÎØº Îß§ÎãàÏ†Ä', 'ÌïúÏßÄÌòú Îß§ÎãàÏ†Ä'] },
                        { id: 'sales_2', name: 'ÏÑúÎπÑÏä§Ïö¥ÏòÅ 2ÌåÄ', members: ['Í∂åÏ†ïÏïÑ Î¶¨ÎìúÎß§ÎãàÏ†Ä', 'ÍπÄÏàòÏßÑ Îß§ÎãàÏ†Ä'] },
                        { id: 'sales_3', name: 'ÏÑúÎπÑÏä§Ïö¥ÏòÅ 3ÌåÄ', members: ['Ï£ºÌòÑÏßÑ Î¶¨ÎìúÎß§ÎãàÏ†Ä', 'ÏÜ°Î≥¥Îûå Îß§ÎãàÏ†Ä'] },
                        { id: 'sales_team', name: 'ÏòÅÏóÖÌåÄ', members: ['Ïù¥ÌïÑÏÑ† Îß§ÎãàÏ†Ä'] }
                    ]
                },
                {
                    id: 'design', name: 'ÏÑ§Í≥Ñ/Ï†ÅÏÇ∞ÌåÄ', color: 'purple',
                    leader: 'Ï°∞ÌòÑÏãù Ïù¥ÏÇ¨', headcount: 3,
                    subDepts: [
                        { id: 'est_team', name: 'Ï†ÅÏÇ∞ÌåÄ', members: ['ÍπÄÏòÅÏÑ≠ Î¶¨ÎìúÎß§ÎãàÏ†Ä', 'Ïã†ÏàòÏßÑ Îß§ÎãàÏ†Ä'] },
                        { id: 'apt_square', name: 'ÏïÑÌååÌä∏Ïä§ÌÄòÏñ¥ÌåÄ', members: ['ÌïúÎØºÍ∑ú Î¶¨ÎìúÎß§ÎãàÏ†Ä'] }
                    ]
                },
                {
                    id: 'mgmt', name: 'Í≤ΩÏòÅÍ¥ÄÎ¶¨Î≥∏Î∂Ä', color: 'orange',
                    leader: 'Î∞±Ï†ïÏÑù Ïù¥ÏÇ¨', headcount: 6,
                    subDepts: [
                        { id: 'mgmt_team', name: 'Í≤ΩÏòÅÍ¥ÄÎ¶¨ÌåÄ', members: ['Ïã†ÎÇòÏòÅ Î¶¨ÎìúÎß§ÎãàÏ†Ä', 'Ï£ºÏú†ÏßÑ Îß§ÎãàÏ†Ä', 'ÏµúÍ≤ΩÏò• Îß§ÎãàÏ†Ä', 'ÍπÄÏú†Î¶º Îß§ÎãàÏ†Ä'] },
                        { id: 'growth', name: 'Í∑∏Î°úÏä§ÌåÄ', members: ['Ïù¥Ïû¨Ìõà Î¶¨ÎìúÎß§ÎãàÏ†Ä', 'ÍπÄÎ≤îÏÑù Îß§ÎãàÏ†Ä'] }
                    ]
                },
                {
                    id: 'brand', name: 'Î∏åÎûúÎìúÎßàÏºÄÌåÖÌåÄ', color: 'pink',
                    leader: 'Í∂åÌòúÏòÅ Î¶¨ÎìúÎß§ÎãàÏ†Ä', headcount: 3,
                    subDepts: [
                        { id: 'brand_team', name: 'Î∏åÎûúÎìúÎßàÏºÄÌåÖÌåÄ', members: ['Í∂åÌòúÏòÅ Î¶¨ÎìúÎß§ÎãàÏ†Ä', 'Ìï®ÏßÄÎØº Îß§ÎãàÏ†Ä', 'ÍπÄÏÜåÎùº Îß§ÎãàÏ†Ä'] }
                    ]
                },
                {
                    id: 'commerce', name: 'Ïª§Î®∏Ïä§ÏÇ¨ÏóÖÎ≥∏Î∂Ä', color: 'cyan',
                    leader: 'ÌóàÏßÄÏú§ Î¶¨ÎìúÎß§ÎãàÏ†Ä', headcount: 8,
                    subDepts: [
                        { id: 'brand_comm', name: 'Î∏åÎûúÎìúÏª§Î®∏Ïä§ÌåÄ', members: ['Ïù¥ÎûÄ Îß§ÎãàÏ†Ä'] },
                        { id: 'media_comm', name: 'ÎØ∏ÎîîÏñ¥Ïª§Î®∏Ïä§ÌåÄ', members: ['Î∞©ÌòÑÏàò Î¶¨ÎìúÎß§ÎãàÏ†Ä', 'ÍπÄÏÜåÏó∞ Îß§ÎãàÏ†Ä', 'ÎÇ®Ïú§Ï†ï Îß§ÎãàÏ†Ä'] },
                        { id: 'overseas', name: 'Ìï¥Ïô∏ÏÇ¨ÏóÖÌåÄ', members: ['ÍπÄÏ±ÑÏõê Îß§ÎãàÏ†Ä', 'Ï©êÌã∞Î¶¨ Îß§ÎãàÏ†Ä'] },
                        { id: 'moyeora', name: 'Î™®Ïó¨ÎùºÎîúÌåÄ', members: ['ÍπÄÏÜ°Ìù¨ Î¶¨ÎìúÎß§ÎãàÏ†Ä', 'Ïù¥Ï±ÑÏùÄ Îß§ÎãàÏ†Ä'] }
                    ]
                },
                {
                    id: 'rnd', name: 'Í∏∞Ïà†Ïó∞Íµ¨ÏÜå', color: 'purple',
                    leader: 'Ï†ïÏòÅÏû¨ Í∏∞Ïà†Ïó∞Íµ¨ÏÜåÏû•', headcount: 3,
                    subDepts: [
                        { id: 'rnd_team', name: 'Í∏∞Ïà†Ïó∞Íµ¨ÏÜå', members: ['Ïã†Î™ÖÌù¨ ÏÑ†ÏûÑÏó∞Íµ¨Ïõê', 'Ïã¨ÌòúÏßÑ Ïó∞Íµ¨Ïõê', 'ÍπÄÏÜåÏ†ï Ïó∞Íµ¨Ïõê'] }
                    ]
                },
                {
                    id: 'factory', name: 'Ïö©Ïù∏Í≥µÏû•', color: 'green',
                    leader: 'ÍπÄÏÑ±Ï§Ä Í≥µÏû•Ïû•', headcount: 3,
                    subDepts: [
                        { id: 'factory_admin', name: 'Í¥ÄÎ¶¨ÌåÄ', members: ['Ïù¥ÎÇòÎùº Îß§ÎãàÏ†Ä'] },
                        { id: 'factory_prod', name: 'ÏÉùÏÇ∞/ÌíàÏßàÍ¥ÄÎ¶¨ÌåÄ', members: ['Ïù¥Ïû¨ÎØº Î¶¨ÎìúÎß§ÎãàÏ†Ä', 'ÍπÄÏú†ÏßÑ Îß§ÎãàÏ†Ä'] }
                    ]
                }
            ]
        };

        let taskData = {};
        let curDept = null, curSub = null, editIdx = null;
        let barChart = null, donutChart = null;

        function generateDummyData() {
            return {
                'sales_1': [
                    { name: '1Î∂ÑÍ∏∞ ÏòÅÏóÖ Î™©Ìëú ÏàòÎ¶Ω', assignee: 'ÌïúÏ§ÄÏóΩ Î¶¨ÎìúÎß§ÎãàÏ†Ä', progress: 100 },
                    { name: 'Ïã†Í∑ú Í±∞ÎûòÏ≤ò Î∞úÍµ¥', assignee: 'Ï°∞Ïû¨Ïó∞ Îß§ÎãàÏ†Ä', progress: 80 },
                    { name: 'Í∏∞Ï°¥ Í≥†Í∞ù Ïú†ÏßÄ Í¥ÄÎ¶¨', assignee: 'Ïû•Ï†ïÌõà Îß§ÎãàÏ†Ä', progress: 70 },
                    { name: 'ÏòÅÏóÖ Ïã§Ï†Å Î≥¥Í≥†ÏÑú ÏûëÏÑ±', assignee: 'ÍπÄÏÑ±ÎØº Îß§ÎãàÏ†Ä', progress: 90 },
                    { name: 'Í≥†Í∞ù ÎßåÏ°±ÎèÑ Ï°∞ÏÇ¨', assignee: 'ÌïúÏßÄÌòú Îß§ÎãàÏ†Ä', progress: 60 }
                ],
                'sales_2': [
                    { name: 'ÏÑúÎπÑÏä§ Ïö¥ÏòÅ Îß§Îâ¥Ïñº Ï†ïÎπÑ', assignee: 'Í∂åÏ†ïÏïÑ Î¶¨ÎìúÎß§ÎãàÏ†Ä', progress: 100 },
                    { name: 'Í≥†Í∞ù ÏùëÎåÄ ÌîÑÎ°úÏÑ∏Ïä§ Í∞úÏÑ†', assignee: 'ÍπÄÏàòÏßÑ Îß§ÎãàÏ†Ä', progress: 85 }
                ],
                'sales_3': [
                    { name: 'CS ÏùëÎåÄ ÏãúÏä§ÌÖú Íµ¨Ï∂ï', assignee: 'Ï£ºÌòÑÏßÑ Î¶¨ÎìúÎß§ÎãàÏ†Ä', progress: 75 },
                    { name: 'Î∂àÎßå Í≥†Í∞ù ÏºÄÏñ¥ ÌîÑÎ°úÍ∑∏Îû®', assignee: 'ÏÜ°Î≥¥Îûå Îß§ÎãàÏ†Ä', progress: 50 }
                ],
                'sales_team': [
                    { name: 'Ïã†Í∑ú Í≥ÑÏïΩ 10Í±¥ Îã¨ÏÑ±', assignee: 'Ïù¥ÌïÑÏÑ† Îß§ÎãàÏ†Ä', progress: 40 }
                ],
                'est_team': [
                    { name: 'Ï†ÅÏÇ∞ ÏãúÏä§ÌÖú Í≥†ÎèÑÌôî', assignee: 'ÍπÄÏòÅÏÑ≠ Î¶¨ÎìúÎß§ÎãàÏ†Ä', progress: 90 },
                    { name: 'ÏõêÍ∞Ä Î∂ÑÏÑù Î¶¨Ìè¨Ìä∏', assignee: 'Ïã†ÏàòÏßÑ Îß§ÎãàÏ†Ä', progress: 70 }
                ],
                'apt_square': [
                    { name: 'ÏïÑÌååÌä∏Ïä§ÌÄòÏñ¥ 2.0 Í∏∞Ìöç', assignee: 'ÌïúÎØºÍ∑ú Î¶¨ÎìúÎß§ÎãàÏ†Ä', progress: 65 }
                ],
                'mgmt_team': [
                    { name: '2026 ÏòàÏÇ∞ Ìé∏ÏÑ±', assignee: 'Ïã†ÎÇòÏòÅ Î¶¨ÎìúÎß§ÎãàÏ†Ä', progress: 100 },
                    { name: 'Î∂ÑÍ∏∞Î≥Ñ Ïû¨Î¨¥Ï†úÌëú ÏûëÏÑ±', assignee: 'Ï£ºÏú†ÏßÑ Îß§ÎãàÏ†Ä', progress: 80 },
                    { name: 'Ïù∏ÏÇ¨ ÌèâÍ∞Ä ÏãúÏä§ÌÖú Í∞úÏÑ†', assignee: 'ÏµúÍ≤ΩÏò• Îß§ÎãàÏ†Ä', progress: 60 },
                    { name: 'Î≥µÎ¶¨ÌõÑÏÉù ÌîÑÎ°úÍ∑∏Îû® Í∏∞Ìöç', assignee: 'ÍπÄÏú†Î¶º Îß§ÎãàÏ†Ä', progress: 45 }
                ],
                'growth': [
                    { name: 'KPI ÎåÄÏãúÎ≥¥Îìú Í∞úÎ∞ú', assignee: 'Ïù¥Ïû¨Ìõà Î¶¨ÎìúÎß§ÎãàÏ†Ä', progress: 95 },
                    { name: 'Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑù ÏûêÎèôÌôî', assignee: 'ÍπÄÎ≤îÏÑù Îß§ÎãàÏ†Ä', progress: 85 }
                ],
                'brand_team': [
                    { name: 'Î∏åÎûúÎìú Î¶¨Îâ¥Ïñº ÌîÑÎ°úÏ†ùÌä∏', assignee: 'Í∂åÌòúÏòÅ Î¶¨ÎìúÎß§ÎãàÏ†Ä', progress: 70 },
                    { name: 'SNS ÏΩòÌÖêÏ∏† Í∏∞Ìöç', assignee: 'Ìï®ÏßÄÎØº Îß§ÎãàÏ†Ä', progress: 80 },
                    { name: 'Î≥¥ÎèÑÏûêÎ£å Î∞∞Ìè¨', assignee: 'ÍπÄÏÜåÎùº Îß§ÎãàÏ†Ä', progress: 100 }
                ],
                'brand_comm': [
                    { name: 'Î∏åÎûúÎìú Ïª§Î®∏Ïä§ Ï†ÑÎûµ ÏàòÎ¶Ω', assignee: 'Ïù¥ÎûÄ Îß§ÎãàÏ†Ä', progress: 60 }
                ],
                'media_comm': [
                    { name: 'ÎùºÏù¥Î∏åÏª§Î®∏Ïä§ Ïö¥ÏòÅ', assignee: 'Î∞©ÌòÑÏàò Î¶¨ÎìúÎß§ÎãàÏ†Ä', progress: 90 },
                    { name: 'Ïù∏ÌîåÎ£®Ïñ∏ÏÑú ÌòëÏóÖ', assignee: 'ÍπÄÏÜåÏó∞ Îß§ÎãàÏ†Ä', progress: 75 },
                    { name: 'Í¥ëÍ≥† ÏÑ±Í≥º Î∂ÑÏÑù', assignee: 'ÎÇ®Ïú§Ï†ï Îß§ÎãàÏ†Ä', progress: 85 }
                ],
                'overseas': [
                    { name: 'Ìï¥Ïô∏ ÏãúÏû• Ï°∞ÏÇ¨', assignee: 'ÍπÄÏ±ÑÏõê Îß§ÎãàÏ†Ä', progress: 50 },
                    { name: 'ÌòÑÏßÄ ÌååÌä∏ÎÑàÏã≠ Íµ¨Ï∂ï', assignee: 'Ï©êÌã∞Î¶¨ Îß§ÎãàÏ†Ä', progress: 35 }
                ],
                'moyeora': [
                    { name: 'Î™®Ïó¨ÎùºÎîú ÌîåÎû´Ìèº Í∞úÏÑ†', assignee: 'ÍπÄÏÜ°Ìù¨ Î¶¨ÎìúÎß§ÎãàÏ†Ä', progress: 80 },
                    { name: 'Îîú ÏÉÅÌíà ÏÜåÏã±', assignee: 'Ïù¥Ï±ÑÏùÄ Îß§ÎãàÏ†Ä', progress: 70 }
                ],
                'rnd_team': [
                    { name: 'AI Í≤∞Ìï® ÏßÑÎã® Î™®Îç∏ Í∞úÎ∞ú', assignee: 'Ïã†Î™ÖÌù¨ ÏÑ†ÏûÑÏó∞Íµ¨Ïõê', progress: 85 },
                    { name: 'ÌäπÌóà Ï∂úÏõê Ï§ÄÎπÑ', assignee: 'Ïã¨ÌòúÏßÑ Ïó∞Íµ¨Ïõê', progress: 60 },
                    { name: 'Ïã†Í∏∞Ïà† Î¶¨ÏÑúÏπò', assignee: 'ÍπÄÏÜåÏ†ï Ïó∞Íµ¨Ïõê', progress: 40 }
                ],
                'factory_admin': [
                    { name: 'Í≥µÏû• Ïö¥ÏòÅ Ìö®Ïú®Ìôî', assignee: 'Ïù¥ÎÇòÎùº Îß§ÎãàÏ†Ä', progress: 75 }
                ],
                'factory_prod': [
                    { name: 'ÏÉùÏÇ∞ ÎùºÏù∏ ÏµúÏ†ÅÌôî', assignee: 'Ïù¥Ïû¨ÎØº Î¶¨ÎìúÎß§ÎãàÏ†Ä', progress: 90 },
                    { name: 'ÌíàÏßà Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú Íµ¨Ï∂ï', assignee: 'ÍπÄÏú†ÏßÑ Îß§ÎãàÏ†Ä', progress: 65 }
                ]
            };
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            if (Object.keys(taskData).length === 0) {
                taskData = generateDummyData();
                saveData();
            }
            renderNav();
            renderDeptGrid();
            initCharts();
            calcAll();
        });

        const getName = f => f.split(' ')[0];
        const getAvatar = f => { const n = f.split(' ')[0]; return n.length >= 2 ? n.slice(1) : n; };
        const getColorClass = p => p < 30 ? 'critical' : p < 50 ? 'low' : '';

        function renderNav() {
            document.getElementById('navDepts').innerHTML = ORG.departments.map(d => 
                `<div class="nav-item" onclick="showDetail('${d.id}')">${d.name}</div>`
            ).join('');
        }

        function renderDeptGrid() {
            document.getElementById('deptGrid').innerHTML = ORG.departments.map(d => {
                const st = getDeptStats(d.id);
                const c = getColorClass(st.avg);
                return `
                    <div class="dept-card" onclick="showDetail('${d.id}')">
                        <div class="dept-header">
                            <div>
                                <div class="dept-name">${d.name}</div>
                                <div class="dept-leader">${d.leader}</div>
                            </div>
                            <div class="dept-pct ${c}">${st.avg}%</div>
                        </div>
                        <div class="dept-bar">
                            <div class="dept-bar-fill ${c}" style="width:${st.avg}%"></div>
                        </div>
                        <div class="dept-meta">${st.count}Í±¥ ¬∑ ${d.headcount}Î™Ö</div>
                    </div>
                `;
            }).join('');
        }

        function getDeptStats(deptId) {
            const d = ORG.departments.find(x => x.id === deptId);
            if (!d) return { avg: 0, count: 0, members: 0 };
            let total = 0, count = 0;
            const ms = new Set();
            d.subDepts.forEach(s => {
                (taskData[s.id] || []).forEach(t => {
                    total += t.progress;
                    count++;
                    if (t.assignee) ms.add(t.assignee);
                });
            });
            return { avg: count ? Math.round(total / count) : 0, count, members: ms.size };
        }

        function calcAll() {
            let tp = 0, tt = 0, ct = 0;
            const am = new Set();
            const deptData = [];
            const memberStats = {};

            ORG.departments.forEach(d => {
                let dt = 0, dc = 0;
                d.subDepts.forEach(s => {
                    (taskData[s.id] || []).forEach(t => {
                        dt += t.progress; dc++; tt++; tp += t.progress;
                        if (t.progress === 100) ct++;
                        if (t.assignee) {
                            am.add(t.assignee);
                            if (!memberStats[t.assignee]) memberStats[t.assignee] = { name: t.assignee, dept: d.name, total: 0, count: 0 };
                            memberStats[t.assignee].total += t.progress;
                            memberStats[t.assignee].count++;
                        }
                    });
                });
                deptData.push(dc ? Math.round(dt / dc) : 0);
            });

            const avg = tt ? Math.round(tp / tt) : 0;

            document.getElementById('statProgress').textContent = avg + '%';
            document.getElementById('statDone').textContent = ct;
            document.getElementById('statTotal').textContent = tt;
            document.getElementById('statMembers').textContent = am.size;

            document.getElementById('donutPct').textContent = (tt ? Math.round(ct / tt * 100) : 0) + '%';
            document.getElementById('dsDone').textContent = ct;
            document.getElementById('dsPending').textContent = tt - ct;

            if (barChart) { barChart.data.datasets[0].data = deptData; barChart.update(); }
            if (donutChart) { donutChart.data.datasets[0].data = [ct, tt - ct]; donutChart.update(); }

            renderWinners(memberStats);
            renderDeptGrid();
        }

        function renderWinners(stats) {
            const list = Object.values(stats);
            list.forEach(m => m.avg = m.count ? Math.round(m.total / m.count) : 0);
            list.sort((a, b) => b.avg - a.avg);
            const top3 = list.slice(0, 3);

            const el = document.getElementById('winnersGrid');
            if (top3.length < 3) {
                el.innerHTML = '<div class="empty-state" style="grid-column:1/-1"><div class="empty-text">ÏóÖÎ¨¥Î•º Îì±Î°ùÌïòÎ©¥ ÌëúÏãúÎê©ÎãàÎã§</div></div>';
                return;
            }

            const ranks = ['gold', 'silver', 'bronze'];
            el.innerHTML = top3.map((m, i) => `
                <div class="winner-card ${ranks[i]}">
                    <div class="winner-rank">${i + 1}</div>
                    <div class="winner-avatar">${getAvatar(m.name)}</div>
                    <div class="winner-name">${getName(m.name)}</div>
                    <div class="winner-dept">${m.dept}</div>
                    <div class="winner-score">${m.avg}%</div>
                    <div class="winner-score-label">ÌèâÍ∑† ÏßÑÏ≤ôÎ•†</div>
                </div>
            `).join('');
        }

        function initCharts() {
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            const gridColor = isDark ? '#2a2a2a' : '#f2f4f6';
            const textColor = isDark ? '#b0b8c1' : '#4e5968';
            
            barChart = new Chart(document.getElementById('barChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: ORG.departments.map(d => d.name.replace('Î≥∏Î∂Ä', '').replace('ÌåÄ', '').replace('Í∏∞Ïà†Ïó∞Íµ¨ÏÜå', 'Ïó∞Íµ¨ÏÜå')),
                    datasets: [{ data: [0,0,0,0,0,0,0], backgroundColor: '#3182f6', borderRadius: 6, barThickness: 32 }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, max: 100, ticks: { callback: v => v + '%', color: textColor }, grid: { color: gridColor } },
                        x: { grid: { display: false }, ticks: { font: { size: 12 }, color: textColor } }
                    }
                }
            });

            donutChart = new Chart(document.getElementById('donutChart').getContext('2d'), {
                type: 'doughnut',
                data: { datasets: [{ data: [0, 100], backgroundColor: ['#3182f6', isDark ? '#2a2a2a' : '#e5e8eb'], borderWidth: 0 }] },
                options: { responsive: true, maintainAspectRatio: false, cutout: '75%', plugins: { legend: { display: false } } }
            });
        }

        function goMain() {
            document.getElementById('mainPage').classList.add('active');
            document.getElementById('detailPage').classList.remove('active');
            document.querySelectorAll('.nav-item').forEach((el, i) => el.classList.toggle('active', i === 0));
            curDept = curSub = null;
            calcAll();
        }

        function showDetail(deptId, subId = null) {
            const d = ORG.departments.find(x => x.id === deptId);
            if (!d) return;
            curDept = deptId; curSub = subId || d.subDepts[0]?.id;

            document.getElementById('mainPage').classList.remove('active');
            document.getElementById('detailPage').classList.add('active');
            document.getElementById('detailTitle').textContent = d.name;
            document.getElementById('detailSubtitle').textContent = d.leader;

            const st = getDeptStats(deptId);
            document.getElementById('detailProgress').textContent = st.avg + '%';
            document.getElementById('detailTasks').textContent = st.count;
            document.getElementById('detailMembers').textContent = st.members;

            document.querySelectorAll('.nav-item').forEach((el, i) => el.classList.toggle('active', i === ORG.departments.findIndex(x => x.id === deptId) + 1));

            renderTabs(d); renderMembers(deptId); renderTasks();
        }

        function renderTabs(d) {
            document.getElementById('tabs').innerHTML = d.subDepts.map(s => 
                `<button class="tab ${s.id === curSub ? 'active' : ''}" onclick="switchSub('${s.id}', this)">${s.name}</button>`
            ).join('');
        }

        function switchSub(subId, el) {
            curSub = subId;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            updateAssignees(); renderMembers(curDept); renderTasks();
        }

        function renderMembers(deptId) {
            const d = ORG.departments.find(x => x.id === deptId);
            const currentSub = d.subDepts.find(s => s.id === curSub);
            if (!currentSub) return;

            const stats = {};
            currentSub.members.forEach(m => { stats[m] = { name: m, sub: currentSub.name, total: 0, count: 0 }; });
            (taskData[curSub] || []).forEach(t => {
                if (t.assignee && stats[t.assignee]) {
                    stats[t.assignee].total += t.progress;
                    stats[t.assignee].count++;
                }
            });

            const list = Object.values(stats);
            list.forEach(m => m.avg = m.count ? Math.round(m.total / m.count) : 0);

            document.getElementById('memberGrid').innerHTML = list.length ? list.map(m => `
                <div class="member-card" onclick="showModal('${m.name}','${deptId}')">
                    <div class="member-avatar">${getAvatar(m.name)}</div>
                    <div class="member-info">
                        <div class="member-name">${getName(m.name)}</div>
                        <div class="member-role">${m.sub}</div>
                    </div>
                    <div class="member-right">
                        <div class="member-pct">${m.count ? m.avg + '%' : '-'}</div>
                        <div class="member-cnt">${m.count}Í±¥</div>
                    </div>
                </div>
            `).join('') : '<div class="empty-state" style="grid-column:1/-1"><div class="empty-text">ÌåÄÏõêÏù¥ ÏóÜÏäµÎãàÎã§</div></div>';
        }

        function showModal(name, deptId) {
            const d = ORG.departments.find(x => x.id === deptId);
            const tasks = [];
            ORG.departments.forEach(dept => dept.subDepts.forEach(s => (taskData[s.id] || []).forEach(t => { if (t.assignee === name) tasks.push({ ...t, sub: s.name }); })));

            const total = tasks.reduce((sum, t) => sum + t.progress, 0);
            const avg = tasks.length ? Math.round(total / tasks.length) : 0;

            document.getElementById('modalAvatar').textContent = getAvatar(name);
            document.getElementById('modalName').textContent = getName(name);
            document.getElementById('modalDept').textContent = d.name;
            document.getElementById('modalProgress').textContent = avg + '%';
            document.getElementById('modalTasks').textContent = tasks.length;
            document.getElementById('modalDone').textContent = tasks.filter(t => t.progress === 100).length;
            document.getElementById('modalBody').innerHTML = tasks.length ? tasks.map(t => `
                <div class="modal-task">
                    <div><div class="modal-task-name">${t.name}</div><div class="modal-task-sub">${t.sub}</div></div>
                    <div class="modal-task-pct">${t.progress}%</div>
                </div>
            `).join('') : '<div class="empty-state"><div class="empty-text">Îã¥Îãπ ÏóÖÎ¨¥Í∞Ä ÏóÜÏäµÎãàÎã§</div></div>';

            document.getElementById('modal').classList.add('show');
        }

        function closeModal() { document.getElementById('modal').classList.remove('show'); }
        document.getElementById('modal').addEventListener('click', e => { if (e.target.id === 'modal') closeModal(); });

        function renderTasks() {
            if (!curSub) return;
            const tasks = taskData[curSub] || [];
            updateAssignees();

            const d = ORG.departments.find(x => x.id === curDept);
            const s = d?.subDepts.find(x => x.id === curSub);
            const members = s?.members || [];

            document.getElementById('taskList').innerHTML = tasks.length ? tasks.map((t, i) => {
                const isEdit = editIdx === i;
                return `
                    <div class="task-item">
                        <div class="task-name">
                            <span class="${isEdit ? 'hide' : ''}">${t.name}</span>
                            <input type="text" class="${isEdit ? 'show' : ''}" value="${t.name}" id="editInput_${i}" onkeypress="if(event.key==='Enter')saveEdit(${i})">
                        </div>
                        <select class="task-select" onchange="updateTask(${i},'assignee',this.value)">
                            <option value="">Îã¥ÎãπÏûê</option>
                            ${members.map(m => `<option value="${m}" ${t.assignee===m?'selected':''}>${getName(m)}</option>`).join('')}
                        </select>
                        <select class="task-select" onchange="updateTask(${i},'progress',this.value)">
                            ${[0,10,20,30,40,50,60,70,80,90,100].map(p => `<option value="${p}" ${t.progress===p?'selected':''}>${p}%</option>`).join('')}
                        </select>
                        <div class="task-actions">
                            ${isEdit ? `
                                <button class="btn-xs btn-edit" onclick="saveEdit(${i})">Ï†ÄÏû•</button>
                                <button class="btn-xs btn-del" onclick="cancelEdit()">Ï∑®ÏÜå</button>
                            ` : `
                                <button class="btn-xs btn-edit" onclick="startEdit(${i})">ÏàòÏ†ï</button>
                                <button class="btn-xs btn-del" onclick="deleteTask(${i})">ÏÇ≠Ï†ú</button>
                            `}
                        </div>
                    </div>
                `;
            }).join('') : '<div class="empty-state"><div class="empty-text">Îì±Î°ùÎêú ÏóÖÎ¨¥Í∞Ä ÏóÜÏäµÎãàÎã§</div></div>';
        }

        function updateAssignees() {
            const d = ORG.departments.find(x => x.id === curDept);
            const s = d?.subDepts.find(x => x.id === curSub);
            const sel = document.getElementById('newAssignee');
            if (sel) sel.innerHTML = '<option value="">Îã¥ÎãπÏûê</option>' + (s?.members || []).map(m => `<option value="${m}">${getName(m)}</option>`).join('');
        }

        function showTaskForm() { document.getElementById('taskForm').classList.add('show'); document.getElementById('newName').focus(); }
        function hideTaskForm() { document.getElementById('taskForm').classList.remove('show'); document.getElementById('newName').value = ''; document.getElementById('newAssignee').value = ''; document.getElementById('newProgress').value = '0'; }

        function addTask() {
            const name = document.getElementById('newName').value.trim();
            if (!name) return alert('ÏóÖÎ¨¥Î™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî');
            if (!taskData[curSub]) taskData[curSub] = [];
            taskData[curSub].push({ name, assignee: document.getElementById('newAssignee').value, progress: parseInt(document.getElementById('newProgress').value) });
            renderTasks(); renderMembers(curDept); updateDetail(); calcAll(); hideTaskForm(); saveData(); toast('‚úÖ ÏóÖÎ¨¥Í∞Ä Îì±Î°ùÎêòÏóàÏäµÎãàÎã§');
        }

        function updateTask(i, field, val) {
            if (taskData[curSub]?.[i]) {
                taskData[curSub][i][field] = field === 'progress' ? parseInt(val) : val;
                renderTasks(); renderMembers(curDept); updateDetail(); calcAll(); saveData();
            }
        }

        function startEdit(i) { editIdx = i; renderTasks(); setTimeout(() => { const inp = document.getElementById(`editInput_${i}`); if (inp) { inp.focus(); inp.select(); } }, 50); }
        function saveEdit(i) { const inp = document.getElementById(`editInput_${i}`); if (inp?.value.trim() && taskData[curSub]?.[i]) { taskData[curSub][i].name = inp.value.trim(); saveData(); toast('‚úèÔ∏è ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§'); } editIdx = null; renderTasks(); }
        function cancelEdit() { editIdx = null; renderTasks(); }
        function deleteTask(i) { if (confirm('ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) { taskData[curSub].splice(i, 1); renderTasks(); renderMembers(curDept); updateDetail(); calcAll(); saveData(); toast('üóëÔ∏è ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§'); } }

        function updateDetail() {
            const st = getDeptStats(curDept);
            document.getElementById('detailProgress').textContent = st.avg + '%';
            document.getElementById('detailTasks').textContent = st.count;
            document.getElementById('detailMembers').textContent = st.members;
        }

        function saveData() { localStorage.setItem('netform_kpi_v12', JSON.stringify(taskData)); }
        function loadData() { const saved = localStorage.getItem('netform_kpi_v12'); if (saved) taskData = JSON.parse(saved); }
        function saveAll() { saveData(); toast('‚úÖ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§'); }

        function exportData() {
            const blob = new Blob([JSON.stringify({ company: 'ÎÑ∑ÌèºÏïåÏï§Îîî', date: new Date().toISOString(), tasks: taskData }, null, 2)], { type: 'application/json' });
            const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
            a.download = `ÎÑ∑ÌèºÏïåÏï§Îîî_KPI_${new Date().toISOString().split('T')[0]}.json`; a.click();
            toast('üì§ ÎÇ¥Î≥¥ÎÇ¥Í∏∞ ÏôÑÎ£å');
        }

        function toast(msg) { const el = document.getElementById('toast'); el.textContent = msg; el.classList.add('show'); setTimeout(() => el.classList.remove('show'), 2500); }
        document.addEventListener('keydown', e => { if (e.key === 'Escape') { if (editIdx !== null) cancelEdit(); closeModal(); hideTaskForm(); } });

        // Îã§ÌÅ¨Î™®Îìú ÌÜ†Í∏Ä
        function toggleTheme() {
            const html = document.documentElement;
            const isDark = html.getAttribute('data-theme') === 'dark';
            
            if (isDark) {
                html.removeAttribute('data-theme');
                localStorage.setItem('theme', 'light');
            } else {
                html.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
            }
            
            updateChartColors();
        }

        function updateChartColors() {
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            const gridColor = isDark ? '#2a2a2a' : '#f2f4f6';
            const textColor = isDark ? '#b0b8c1' : '#4e5968';
            
            if (barChart) {
                barChart.options.scales.y.grid.color = gridColor;
                barChart.options.scales.y.ticks.color = textColor;
                barChart.options.scales.x.ticks.color = textColor;
                barChart.update();
            }
            
            if (donutChart) {
                donutChart.data.datasets[0].backgroundColor = ['#3182f6', isDark ? '#2a2a2a' : '#e5e8eb'];
                donutChart.update();
            }
        }

        // Ï¥àÍ∏∞ ÌÖåÎßà Î°úÎìú
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        }

        loadTheme();
    </script>
</body>
</html>
